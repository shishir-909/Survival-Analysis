{
  "hash": "063a373d59f2b0a0bec105696b71bd7d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"A Demonstration of Multivariate Normal Imputation\"\nsubtitle: \"Better than Mean Imputation and Regression Imputation\"\n# shorttitle: \"Handout Layout\"\ndocumenttype: Handout\nprefer-html: true\nabstract: |\n  When we have missing data in a dataset, we need to impute those missing values before we can use the data for analysis. There are several methods for imputing missing data, including mean imputation, regression imputation, and multivariate normal imputation. In this blog post, we will explore the advantages of multivariate normal imputation over mean imputation and regression imputation, and how to implement it using Bayesian modeling.\n\nauthor: \n  - name: \"Shishir Rao\"\n    email: shishir@calgaryanalyticsltd.com\n  # - url: https://calgaryanalyticsltd.com\ntoc: true\n\nversion: [v.1.0]\ndate: last-modified\nexecute: \n  echo: fenced\n  freeze: auto\nbibliography: references.bib\nbibliographystyle: \"springer-humanities-author-date\"  \n\n---\n\n# Introduction\n\n::: {.column-margin dy=-11cm}\n\n![Hoff, P. D. (2009). A first course in Bayesian statistical methods. Springer. [https://doi.org/10.1007/978-0-387-92407-6](https://doi.org/10.1007/978-0-387-92407-6)](/Images/BayesianBookHoff.png){width=75%}\n\n:::\n\nRecently, I have been revisiting my notes from the course on Applied Bayesian Methods that I took in grad school. There is a chapter in the book on the Multivariate Normal model. One of the sections in the chapter discusses missing data and how to impute them using the Multivariate Normal model. An exercise problem at the end of the chapter asks to conduct a pairwise comparison of the means of two groups which contain missing data. First, the author suggests using regression imputation to impute the missing data in the dataset and then compare the means of the two groups using a pairwise t-test. Next, he suggests using the Multivariate Normal model to impute the missing data and then compare the means of the two groups. The results of the two methods lead to opposite conclusions. The t-test shows a significant result for the difference between the two groups when using regression imputation, but no significant difference was found when using the Multivariate Normal model for imputation. I thought this was an excellent example to illustrate the difference between multiple imputation using the Multivariate Normal model and single imputation methods like regression imputation, and why the former is a better method (under certain conditions).  \n\nIn this blog, I pick another dataset for pairwise comparison using the t-test with regression imputation and Multivariate Normal imputation and discuss the results of the two methods. \n\n# Dataset\n\nFor the purpose of this blog, we will use the Concrete Compressive Strength dataset available on the UC Irvine Machine Learning Repository website. The full dataset can be found [here](https://archive.ics.uci.edu/ml/datasets/concrete+compressive+strength)[^2].\n\n[^2]: Yeh, I. (1998). Concrete Compressive Strength. UCI Machine Learning Repository. https://doi.org/10.24432/C5PK67.\n\nThe actual concrete compressive strength (MPa) for a given mixture under a specific aga (days) was determined in the laboratory. We will compare the compressive strength on day 3 vs day 7. The strength on day 7 is expected to be higher than day 3 with a very high probability due to the nature of concrete. So, instead of testing for difference in means, we will test the hypothesis that the mean strength on day 7 is higher than day 3 by a certain margin (say 5 MPa).\n\nA subset of the dataset with only the relevant columns for this analysis has been extracted. The table below shows the concrete strength for three different ages (in days) for each sample - day 3, day 7 and day 28. I have artificially introduced some missingness in the dataset to illustrate the imputation methods. Note that the missingness is Missing at Random (MAR). This means that the missingness is independent of the sample (and the parameters of the Multivariate Normal model that we will fit).\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'ggplot2' was built under R version 4.4.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(mvtnorm)\nlibrary(knitr)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'knitr' was built under R version 4.4.3\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'kableExtra' was built under R version 4.4.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'kableExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nset.seed(147) # For reproducibility\n\n# Load xls file where the delimiter is the semi colon and the location is \"C:\\\\Users\\\\shish\\\\GitHub\\\\Survival\\\\Survival-Analysis\\\\Blog 12\\\\Data\\\\concrete+compressive+strength\\\\Concrete_Data.xls\"\n\nconcrete_data <- readxl::read_excel(\n  \"C:\\\\Users\\\\shish\\\\GitHub\\\\Survival\\\\Survival-Analysis\\\\Blog 12\\\\Data\\\\concrete+compressive+strength\\\\Concrete_Data.xls\"\n)\n# colnames(concrete_data)\n\n# Subset of the rows and columns for analysis\nconcrete_data_subset <- concrete_data[\n  71:139,\n  c(\"Age (day)\", \"Concrete compressive strength(MPa, megapascals)\")\n]\ncolnames(concrete_data_subset) <- c(\"Age\", \"Strength\")\n\n# Construct a new dataset such that we have one column for every unique Age value in concrete_data_subset which gives us the strength of concrete at that age.\n\nconcrete_data_wide <- concrete_data_subset |>\n  group_by(Age) |>\n  mutate(row_id = row_number()) |>\n  ungroup() |>\n  pivot_wider(\n    names_from = Age,\n    values_from = Strength,\n    names_prefix = \"Day \"\n  ) |>\n  select(-row_id)\n\nknitr::kable(\n  concrete_data_wide,\n  caption = \"Table 1. Concrete Compressive Strength (MPa) at Different Ages (Days)\",\n  align = rep('c', 5),\n  table.envir = 'table*'\n) %>%\n  kableExtra::kable_styling(\"striped\", full_width = T, position = \"left\") %>%\n  kableExtra::scroll_box(height = \"200px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; \"><table class=\"table table-striped\" style=\"\">\n<caption>Table 1. Concrete Compressive Strength (MPa) at Different Ages (Days)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> Day 3 </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> Day 7 </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> Day 28 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 34.39796 </td>\n   <td style=\"text-align:center;\"> 46.20179 </td>\n   <td style=\"text-align:center;\"> 61.09447 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28.79941 </td>\n   <td style=\"text-align:center;\"> 42.79578 </td>\n   <td style=\"text-align:center;\"> 59.79825 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 33.39822 </td>\n   <td style=\"text-align:center;\"> 49.20101 </td>\n   <td style=\"text-align:center;\"> 60.29468 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 36.30091 </td>\n   <td style=\"text-align:center;\"> 46.80163 </td>\n   <td style=\"text-align:center;\"> 61.79773 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28.99936 </td>\n   <td style=\"text-align:center;\"> 45.69847 </td>\n   <td style=\"text-align:center;\"> 56.69561 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 37.79707 </td>\n   <td style=\"text-align:center;\"> 55.59934 </td>\n   <td style=\"text-align:center;\"> 68.29949 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 40.19645 </td>\n   <td style=\"text-align:center;\"> 54.89608 </td>\n   <td style=\"text-align:center;\"> 66.89986 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 33.39822 </td>\n   <td style=\"text-align:center;\"> 49.20101 </td>\n   <td style=\"text-align:center;\"> 60.29468 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28.09615 </td>\n   <td style=\"text-align:center;\"> 34.90128 </td>\n   <td style=\"text-align:center;\"> 50.69717 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 41.29961 </td>\n   <td style=\"text-align:center;\"> 46.89816 </td>\n   <td style=\"text-align:center;\"> 56.39914 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 33.39822 </td>\n   <td style=\"text-align:center;\"> 49.20101 </td>\n   <td style=\"text-align:center;\"> 60.29468 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 25.20035 </td>\n   <td style=\"text-align:center;\"> 33.39822 </td>\n   <td style=\"text-align:center;\"> 55.49592 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 41.09966 </td>\n   <td style=\"text-align:center;\"> 54.09629 </td>\n   <td style=\"text-align:center;\"> 68.49944 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 35.30117 </td>\n   <td style=\"text-align:center;\"> 55.89582 </td>\n   <td style=\"text-align:center;\"> 71.29871 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28.29610 </td>\n   <td style=\"text-align:center;\"> 49.80085 </td>\n   <td style=\"text-align:center;\"> 74.69783 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28.59946 </td>\n   <td style=\"text-align:center;\"> 47.09811 </td>\n   <td style=\"text-align:center;\"> 52.20023 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 35.30117 </td>\n   <td style=\"text-align:center;\"> 55.89582 </td>\n   <td style=\"text-align:center;\"> 71.29871 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 24.40056 </td>\n   <td style=\"text-align:center;\"> 37.99702 </td>\n   <td style=\"text-align:center;\"> 67.69965 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 35.30117 </td>\n   <td style=\"text-align:center;\"> 55.89582 </td>\n   <td style=\"text-align:center;\"> 71.29871 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 39.30013 </td>\n   <td style=\"text-align:center;\"> 56.09577 </td>\n   <td style=\"text-align:center;\"> 65.99664 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 40.59635 </td>\n   <td style=\"text-align:center;\"> 59.09499 </td>\n   <td style=\"text-align:center;\"> 74.49788 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 35.30117 </td>\n   <td style=\"text-align:center;\"> 22.89750 </td>\n   <td style=\"text-align:center;\"> 71.29871 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 24.09719 </td>\n   <td style=\"text-align:center;\"> 35.10122 </td>\n   <td style=\"text-align:center;\"> 49.89738 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n\n<!-- \n\n\n::: {#cell-fig-margin .cell .column-margin}\n\n```{.r .cell-code .hidden}\nlibrary(ggplot2)\nmtcars2 <- mtcars\nmtcars2$am <- factor(\n  mtcars$am,\n  labels = c('automatic', 'manual')\n)\nggplot(mtcars2, aes(hp, mpg, color = am)) +\n  geom_point() +\n  geom_smooth() +\n  theme(legend.position = 'bottom')\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![MPG vs horsepower, colored by transmission.](index_files/figure-html/fig-margin-1.png){#fig-margin width=672}\n:::\n:::\n\n\nNote the use of the `fig-cap` chunk option to provide a figure caption. You can adjust the proportions of figures using the `fig-width` and `fig-height` chunk options. These are specified in inches, and will be automatically scaled down to fit within the handout margin. -->\n\n# Usage\n\n## Arbitrary Margin Content\n\nYou can include anything in the margin by places the class `.column-margin` on the element. See an example on the right about the first fundamental theorem of calculus.\n\n::: {.column-margin dy=-6em}\nWe know from *the first fundamental theorem of calculus* that for $x$ in $[a, b]$:\n\n$$\\frac{d}{dx}\\left( \\int_{a}^{x} f(u)\\,du\\right)=f(x).$$\n\n:::\n\n\n## Arbitrary Full Width Content\n\nAny content can span to the full width of the page, simply place the element in a `div` and add the class `column-page-right`. For example, the following code will display its contents as full width.\n\n``` md\n::: {.fullwidth}\nAny _full width_ content here.\n:::\n```\n\n\n\n# Acknowledgements {.unlisted}\n\nThanks to the Quarto and Typst teams for these wonderful tools.  This format is made possible by [Quarto's](https://github.com/quarto-dev/quarto-cli/discussions?discussions_q=author%3Afredguth) and [Typst's](https://discord.gg/2uDybryKPe) communities. Special thanks to:\n\n- Mickaël Canouil (`@mcanouil`);\n- Gordon Woodhull (`@gordonwoodhull`);\n- Charles Teague (`@dragonstyle`);\n- Raniere Silva (`@rgaiacs`); and\n- Christophe Dervieux (`@cderv`)\n- `@pgsuper`\n",
    "supporting": [
      "index_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}